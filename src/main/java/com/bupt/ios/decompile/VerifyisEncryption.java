package com.bupt.ios.decompile;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

public class VerifyisEncryption {
	private static Logger LOGGER = LogManager.getLogger(VerifyisEncryption.class);
			
	public  boolean isEncryption(String exefile){
		boolean isEncrypt = false;
		String extractCmd = " otool -l "+exefile +" | grep cryptid";
		String[] exe=new String [ ] {"/bin/sh","-c",extractCmd};
		ProcessBuilder pb= new ProcessBuilder(exe);
		Process ps;
		try {
			ps = pb.start();
			BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(ps.getInputStream()), 1024);
			String lineString;
			while ((lineString=bufferedReader.readLine())!=null) {
				if (lineString.contains("1")) {
//					System.out.println("ipa已加密");
					LOGGER.info("ipa已加密");
					isEncrypt=true;
//					JOptionPane.showMessageDialog(null, "ipa已加密,请解密后再检测!");
				}else {
					LOGGER.info("ipa已破解");
					isEncrypt=false;
				}
				
			}
	} catch (IOException e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
	}
		return isEncrypt;

}
//	public static void  main(String args[]){
//		String fileSeparator = System.getProperty("file.separator");
//		String configs = System.getProperty("user.dir") + fileSeparator + "conf" + fileSeparator + "log4j.properties";
////		//����log4j
//		PropertyConfigurator.configure(configs);
//		boolean s=isEncryption("/home/nancy/workspace/ssca-static-ios/deTemp/微信-5.0.3itunes_Dec_10,_2013_4_18_25_PM/Payload/MicroMessenger.app/MicroMessenger");
//	    System.out.println(s);
//	}
}
